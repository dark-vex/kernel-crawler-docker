name: Build Generic kernel-crawler

on:
  push:
    branches: [ main ]
    paths:
      - Dockerfile.generic

env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  DOCKERFILE: Dockerfile.generic
  RELEASE_NAME: "generic"

jobs:

  build_test_image:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build test image
        uses: ./.github/actions/build-test

  build_release:
    runs-on: ubuntu-latest
    needs: build_test_image

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Build and publish image
        uses: ./.github/actions/build-publish

    outputs:
      version: ${{ steps.release.outputs.version }}